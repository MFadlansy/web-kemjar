<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <style>
        body {
            display: flex;
        }

        nav {
            width: 200px;
            padding: 10px;
            background: #eee;
        }

        section {
            flex: 1;
            padding: 20px;
        }
    </style>
</head>

<body>
    <nav>
        <h3>Menu</h3>
        <ul>
            <li><a href="#" onclick="showPage('input')">Input Data</a></li>
            <li><a href="#" onclick="showPage('profile')">Profil</a></li>
            <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
    </nav>

    <section id="main">
        <div id="inputPage">
            <h2>Input Data</h2>
            <textarea id="dataInput" placeholder="Masukkan data..."></textarea><br>
            <button onclick="saveData()">Simpan</button>

            <h3>Lihat Data</h3>
            <input type="text" id="viewKey" placeholder="Masukkan AES Key"><br>
            <button onclick="loadData()">Tampilkan Data</button>
            <pre id="output"></pre>
        </div>

        <div id="profilePage" style="display:none">
            <h2>Profil</h2>
            <p><strong>Username:</strong> <span id="profileUsername"></span></p>
            <p><strong>Password:</strong> <span id="profilePassword"></span></p>
            <p><strong>AES Key:</strong> <span id="profileKey"></span></p>
        </div>
    </section>

    <script>
        const userId = localStorage.getItem('userId');
        const aesKey = localStorage.getItem('aesKey');
        const username = localStorage.getItem('username');
        const password = localStorage.getItem('password');

        if (!userId || !aesKey) {
            window.location.href = 'login.html';
        }

        function showPage(page) {
            document.getElementById('inputPage').style.display = (page === 'input') ? 'block' : 'none';
            document.getElementById('profilePage').style.display = (page === 'profile') ? 'block' : 'none';
            if (page === 'profile') {
                document.getElementById('profileUsername').textContent = username;
                document.getElementById('profilePassword').textContent = password;
                document.getElementById('profileKey').textContent = aesKey;
            }
        }

        async function saveData() {
            const data = document.getElementById('dataInput').value;
            const res = await fetch('http://localhost:3000/api/data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, data, aesKey })
            });
            alert(res.ok ? 'Data disimpan' : 'Gagal simpan data');
        }

        async function loadData() {
            const inputKey = document.getElementById('viewKey').value;
            if (!inputKey) {
                alert("Masukkan AES Key terlebih dahulu!");
                return;
            }

            const res = await fetch('http://localhost:3000/api/load', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, aesKey: inputKey })
            });

            if (res.ok) {
                const result = await res.json();
                const container = document.getElementById('output');
                container.innerHTML = '';

                result.forEach(item => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                <textarea data-id="${item.id}">${item.data}</textarea><br>
                <button onclick="updateData(${item.id})">Update</button>
                <button onclick="deleteData(${item.id})">Hapus</button>
                <hr>
            `;
                    container.appendChild(div);
                });
            } else {
                alert('Gagal menampilkan data. AES Key mungkin salah.');
            }
        }

        async function updateData(id) {
            const textarea = document.querySelector(`textarea[data-id="${id}"]`);
            const data = textarea.value;

            const res = await fetch(`http://localhost:3000/api/data/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data, aesKey })
            });

            alert(res.ok ? 'Data diperbarui' : 'Gagal memperbarui data');
        }

        async function deleteData(id) {
            if (!confirm("Yakin ingin menghapus data ini?")) return;

            const res = await fetch(`http://localhost:3000/api/data/${id}`, {
                method: 'DELETE'
            });

            if (res.ok) {
                alert('Data dihapus');
                loadData(); // refresh data
            } else {
                alert('Gagal menghapus data');
            }
        }


        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
    </script>
</body>

</html>